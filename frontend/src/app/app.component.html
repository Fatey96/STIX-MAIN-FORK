<!-- Toolbar -->
<h1>Synthetic Cyber Knowledge Graph</h1>

<div class="content" role="main">
  <div class="description-page" [hidden]="isSelectingRelationships">
    <p>This is a description of the scenario. For now, it is just placeholder content. However, it will explain the
      Internet of Vehicles scenario that
      was presented, including the information that should be shown. At the moment, I am not sure how this should be
      stated, so I am just adding more
      words here to take up space. I am also not sure how long this paragraph will be.
    </p>

    <h2>STIX Domain Objects</h2>
    <div class="object-buttons-container">
      <app-object-btn
        *ngFor="let object of [{name: 'Identity', class: 'identity'}, {name: 'Malware', class: 'malware'}, {name: 'Threat Actor', class: 'threat-actor'}]"
        [btnName]="object.name" [btnClass]="object.class" (btnClicked)="onObjectButtonClicked($event)">
      </app-object-btn>
    </div>

    <ng-container
      *ngFor="let box of [{name: 'Identity', type: 'identity', fields: [{ stixProperty: 'name', propertyName: 'Name', isRequired: true }, { stixProperty: 'description', propertyName: 'Description', isRequired: false }, { stixProperty: 'contact_information', propertyName: 'Contact Information', isRequired: false }]}, 
      {name: 'Malware', type: 'malware', fields: [{ stixProperty: 'name', propertyName: 'Name', isRequired: false }, { stixProperty: 'description', propertyName: 'Description', isRequired: false }]}, 
      {name: 'Threat Actor', type: 'threat-actor', fields: [{ stixProperty: 'name', propertyName: 'Name', isRequired: true }, { stixProperty: 'description', propertyName: 'Description', isRequired: false }]}]">
      <app-object-box [boxName]="box.name" [stixType]="box.type" *ngIf="isStixObjectSelected(box.type)"
        (lastFormDeleted)="onLastFormRemoved($event)" (formAdded)="updateTotalFormsCount(1)"
        (formDeleted)="updateTotalFormsCount(-1)" [formFields]="box.fields">
      </app-object-box>
    </ng-container>

    <button class="select-relationships-btn" *ngIf="totalFormsCount >= 2" (click)="onSelectRelationships()">Select
      Relationships</button>
  </div>

  <div class="relationship-page" [hidden]="!isSelectingRelationships">
    <div class="relationship-selection-container">
      <div class="stix-object-column">
        <h2>STIX Domain Objects</h2>
        <ng-container *ngFor="let object of selectedStixObjects">
          <!-- Display the object title -->
          <button class="object-title-buttons" (click)="toggleStixObjectDetailsVisibility(object.name)">
            {{ object.name }}
          </button>

          <!-- Display the object details if the title is selected (visible) -->
          <ng-container *ngIf="selectedStixObjectDetailsVisible[object.name]">
            <div class="object-details-container" *ngFor="let detail of getDetailsForBoxName(object.name)">
              <h4 class="object-title-h4">{{ detail.title }}</h4>
              <ul>
                <ng-container *ngFor="let field of detail.formData">
                  <li *ngIf="field.value && field.value.trim() !== ''">
                    {{ field.key }}: {{ field.value }}
                  </li>
                </ng-container>
              </ul>
            </div>
          </ng-container>
        </ng-container>
      </div>

      <div class="stix-relationship-column">
        <h2>STIX Relationship Objects</h2>
        <input type="radio" id="relationshipRadio" name="relationshipType" value="relationship" class="hidden-radio"
          (change)="selectRelationship()" />
        <label for="relationshipRadio" class="relationship-label">Relationship</label>
        <input type="radio" id="sightingRadio" name="relationshipType" value="sighting" class="hidden-radio"
          (change)="selectSighting()" />
        <label for="sightingRadio" class="relationship-label">Sighting</label>
      </div>

      <div class="if-relationship" *ngIf="selectedRelationshipType === 'relationship'">
        <h2>Create the Relationship</h2>
        <h3>Source Reference:</h3>
        <select [(ngModel)]="selectedSourceReference" (change)="updateAvailableRelationships()">
          <option *ngFor="let detail of selectedStixObjectDetails" [value]="detail.title">{{ detail.title }}</option>
        </select>

        <h3>Target Reference:</h3>
        <select [(ngModel)]="selectedTargetReference" (change)="updateAvailableRelationships()">
          <option *ngFor="let detail of selectedStixObjectDetails" [value]="detail.title">{{ detail.title }}</option>
        </select>

        <h3>Relationship:</h3>
        <select [(ngModel)]="selectedRelationship">
          <option *ngFor="let relationship of availableRelationships" [value]="relationship">{{ relationship }}</option>
        </select>
        <button class="create-btn" (click)="createRelationship()">Create Relationship</button>
      </div>

      <div class="if-sighting" *ngIf="selectedRelationshipType === 'sighting'">
        <h2>Create the Relationship</h2>
        <h3>Sighting of Reference:</h3>
        <select [(ngModel)]="selectedSightingReference">
          <option *ngFor="let detail of selectedStixObjectDetails" [value]="detail.title">{{ detail.title }}</option>
        </select>
        <button class="create-btn" (click)="createSighting()">Create Sighting</button>
      </div>
    </div>

    <div *ngFor="let relationship of createdRelationships" class="selected-relationships-container">
      <!-- If it's a relationship, display Source column -->
      <div class="relationship-column" *ngIf="relationship.type === 'relationship'">
        <h3>Source:</h3>
        <ul class="relationship-detail">
          <h4 class="object-title-h4">{{ relationship.sourceDetail.title }}</h4>
          <ng-container *ngFor="let field of relationship.sourceDetail.formData">
            <li *ngIf="field.value && field.value.trim() !== ''">
              {{ field.key }}: {{ field.value }}
            </li>
          </ng-container>
        </ul>
      </div>

      <!-- If it's a relationship, display Relationship column -->
      <div class="relationship-column" *ngIf="relationship.type === 'relationship'">
        <h3>Relationship:</h3>
        <div class="relationship-detail">
          {{ relationship.relationship }}
        </div>
      </div>

      <!-- If it's a relationship, display Target column -->
      <div class="relationship-column" *ngIf="relationship.type === 'relationship'">
        <h3>Target:</h3>
        <ul class="relationship-detail">
          <h4 class="object-title-h4">{{ relationship.targetDetail.title }}</h4>
          <ng-container *ngFor="let field of relationship.targetDetail.formData">
            <li *ngIf="field.value && field.value.trim() !== ''">
              {{ field.key }}: {{ field.value }}
            </li>
          </ng-container>
        </ul>
      </div>

      <!-- If it's a sighting -->
      <div class="relationship-column" *ngIf="relationship.type === 'sighting'">
        <h3>Sighting of Reference:</h3>
        <ul class="relationship-detail">
          <h4 class="object-title-h4">{{ relationship.sourceDetail.title }}</h4>
          <ng-container *ngFor="let field of relationship.sourceDetail.formData">
            <li *ngIf="field.value && field.value.trim() !== ''">
              {{ field.key }}: {{ field.value }}
            </li>
          </ng-container>
        </ul>
      </div>
    </div>

    <button class="continue" *ngIf="createdRelationships.length > 0" (click)="onContinueClick()">Continue</button>

    <div *ngIf="stixOutput" class="stix-output">
      <pre>{{ stixOutput }}</pre>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <p>This project has been created in collaboration with the <a href="https://www.uncp.edu/"
        target="_blank">University of North Carolina at Pembroke</a>
      and the <a href="https://ncsu-las.org/" target="_blank">NSA/Laboratory for Analytic Sciences</a>.
    </p>
  </footer>
</div>

<router-outlet></router-outlet>